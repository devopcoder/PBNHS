<!DOCTYPE html>
<html>
<head>
Â  <title>ğŸ“· Student Attendance</title>
Â  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
Â  <style>
Â  Â  body {
Â  Â  Â  margin: 0;
Â  Â  Â  font-family: 'Segoe UI', sans-serif;
Â  Â  Â  text-align: center;
Â  Â  Â  background: linear-gradient(to bottom, #B3E5FC 0%, #E1F5FE 50%, #FFFFFF 100%);
Â  Â  Â  color: #003366;
Â  Â  }

Â  Â  h2 {
Â  Â  Â  margin-top: 30px;
Â  Â  Â  font-size: 2rem;
Â  Â  Â  color: #C62828;
Â  Â  Â  background: #FFE082;
Â  Â  Â  display: inline-block;
Â  Â  Â  padding: 10px 20px;
Â  Â  Â  border-radius: 12px;
Â  Â  Â  box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
Â  Â  }

Â  Â  #reader {
Â  Â  Â  margin: 20px auto;
Â  Â  Â  width: 300px;
Â  Â  }

Â  Â  #school-name {
Â  Â  Â  font-size: 1.8rem;
Â  Â  Â  font-weight: bold;
Â  Â  Â  color: #0D47A1;
Â  Â  Â  margin-top: 15px;
Â  Â  Â  background: #FFCDD2;
Â  Â  Â  padding: 8px 16px;
Â  Â  Â  border-radius: 12px;
Â  Â  Â  display: inline-block;
Â  Â  Â  box-shadow: 1px 1px 4px rgba(0,0,0,0.1);
Â  Â  }

Â  Â  #status {
Â  Â  Â  margin-top: 10px;
Â  Â  Â  font-weight: bold;
Â  Â  Â  color: #2E7D32;
Â  Â  }

Â  Â  #overlay {
Â  Â  Â  position: fixed;
Â  Â  Â  top: 0;
Â  Â  Â  left: 0;
Â  Â  Â  width: 100vw;
Â  Â  Â  height: 100vh;
Â  Â  Â  background-color: rgba(0, 0, 0, 0.8);
Â  Â  Â  color: #FFD54F;
Â  Â  Â  display: flex;
Â  Â  Â  align-items: center;
Â  Â  Â  justify-content: center;
Â  Â  Â  font-size: 2rem;
Â  Â  Â  z-index: 999;
Â  Â  Â  visibility: hidden;
Â  Â  }

Â  Â  #overlay.show {
Â  Â  Â  visibility: visible;
Â  Â  }

Â  Â  #switch-btn {
Â  Â  Â  margin-top: 10px;
Â  Â  Â  padding: 10px 15px;
Â  Â  Â  background-color: #0288D1;
Â  Â  Â  color: white;
Â  Â  Â  border: none;
Â  Â  Â  border-radius: 8px;
Â  Â  Â  font-weight: bold;
Â  Â  Â  cursor: pointer;
Â  Â  Â  box-shadow: 1px 2px 4px rgba(0,0,0,0.2);
Â  Â  }

Â  Â  #switch-btn:hover {
Â  Â  Â  background-color: #01579B;
Â  Â  }

Â  Â  h4 {
Â  Â  Â  color: #37474F;
Â  Â  Â  margin-top: 40px;
Â  Â  }
Â  </style>
</head>
<body>
Â  <h2>ğŸ“· Welcome to PBNHS Attendance</h2>
Â  <div id="reader"></div>
Â  <div id="school-name">ğŸ« Pulong Buhangin National High School</div>
Â  <p id="status">Status: Waiting for scan...</p>
Â  <button id="switch-btn">ğŸ”„ Switch Camera</button>
Â  <div id="overlay">âœ… SCAN COMPLETE </div>

Â  <audio id="beep" src="beep-07.wav" preload="auto"></audio>
Â  <h4>BY MARCELO CSS</h4>

Â  <script>
Â  Â  const sheetURL = "https://script.google.com/macros/s/AKfycbwEPd1tybx4XTb_kCTo-uFdp5PmjVqEM5cCeEbqmXvnf6gcNCkdsal7Jqr-tRga3BP1/exec";
Â  Â  const beepSound = document.getElementById("beep");
Â  Â  const overlay = document.getElementById("overlay");
Â  Â  const switchBtn = document.getElementById("switch-btn");

Â  Â  let scanner = new Html5Qrcode("reader");
Â  Â  let isScanning = true;
Â  Â  let currentCameraIndex = 0;
Â  Â  let cameras = [];

Â  Â  function sendToGoogleSheet(data) {
Â  Â  Â  fetch(sheetURL, {
Â  Â  Â  Â  method: "POST",
Â  Â  Â  Â  body: JSON.stringify(data),
Â  Â  Â  })
Â  Â  Â  .then(res => res.text())
Â  Â  Â  .then((resText) => {
Â  Â  Â  Â  document.getElementById("status").innerText = "âœ… Attendance Logged! " + resText;
Â  Â  Â  })
Â  Â  Â  .catch(() => {
Â  Â  Â  Â  document.getElementById("status").innerText = "âŒ Failed to log.";
Â  Â  Â  });
Â  Â  }

Â  Â  function showOverlay() {
Â  Â  Â  overlay.classList.add("show");
Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  overlay.classList.remove("show");
Â  Â  Â  }, 1500);
Â  Â  }

Â  Â  function onScanSuccess(decodedText) {
Â  Â  Â  if (!isScanning) return;

Â  Â  Â  isScanning = false;
Â  Â  Â  try {
Â  Â  Â  Â  const parsed = JSON.parse(decodedText);
Â  Â  Â  Â  document.getElementById("status").innerText = `ğŸ“¤ Logging: ${parsed.name}`;
Â  Â  Â  Â  sendToGoogleSheet(parsed);
Â  Â  Â  Â  beepSound.play();
Â  Â  Â  Â  showOverlay();
Â  Â  Â  } catch (e) {
Â  Â  Â  Â  document.getElementById("status").innerText = "âŒ Invalid QR Code!";
Â  Â  Â  }

Â  Â  Â  scanner.pause();
Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  document.getElementById("status").innerText = "âœ… Ready for next scan";
Â  Â  Â  Â  scanner.resume(cameras[currentCameraIndex].id, { fps: 20, qrbox: 250 }, onScanSuccess);
Â  Â  Â  Â  isScanning = true;
Â  Â  Â  }, 3000);
Â  Â  }

Â  Â  function startCamera(index) {
Â  Â  Â  currentCameraIndex = index;
Â  Â  Â  scanner.start(
Â  Â  Â  Â  cameras[currentCameraIndex].id,
Â  Â  Â  Â  { fps: 20, qrbox: 250 },
Â  Â  Â  Â  onScanSuccess
Â  Â  Â  ).catch(err => {
Â  Â  Â  Â  document.getElementById("status").innerText = "âŒ Failed to start camera.";
Â  Â  Â  });
Â  Â  }

Â  Â  Html5Qrcode.getCameras().then(devices => {
Â  Â  Â  if (devices.length > 0) {
Â  Â  Â  Â  cameras = devices;
Â  Â  Â  Â  startCamera(0);
Â  Â  Â  } else {
Â  Â  Â  Â  document.getElementById("status").innerText = "âŒ No camera found.";
Â  Â  Â  }
Â  Â  }).catch(err => {
Â  Â  Â  document.getElementById("status").innerText = "âŒ Camera Error!";
Â  Â  });

Â  Â  switchBtn.addEventListener("click", () => {
Â  Â  Â  if (cameras.length > 1) {
Â  Â  Â  Â  scanner.stop().then(() => {
Â  Â  Â  Â  Â  currentCameraIndex = (currentCameraIndex + 1) % cameras.length;
Â  Â  Â  Â  Â  startCamera(currentCameraIndex);
Â  Â  Â  Â  });
Â  Â  Â  } else {
Â  Â  Â  Â  alert("Only one camera available.");
Â  Â  Â  }
Â  Â  });
Â  </script>
</body>
</html>
